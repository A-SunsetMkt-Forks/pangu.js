(function(d,i){typeof exports=="object"&&typeof module!="undefined"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(d=typeof globalThis!="undefined"?globalThis:d||self,i(d.pangu={}))})(this,function(d){"use strict";var T=(d,i,$)=>new Promise((y,_)=>{var m=u=>{try{S($.next(u))}catch(f){_(f)}},A=u=>{try{S($.throw(u))}catch(f){_(f)}},S=u=>u.done?y(u.value):Promise.resolve(u.value).then(m,A);S(($=$.apply(d,i)).next())});const i="⺀-⻿⼀-⿟぀-ゟ゠-ヺー-ヿ㄀-ㄯ㈀-㋿㐀-䶿一-鿿豈-﫿",$=new RegExp(`[${i}]`),y=new RegExp(`([${i}])[ ]*([\\:]+|\\.)[ ]*([${i}])`,"g"),_=new RegExp(`([${i}])[ ]*([~\\!;,\\?]+)[ ]*`,"g"),m=new RegExp(`([\\.]{2,}|…)([${i}])`,"g"),A=new RegExp(`([${i}])\\:([A-Z0-9\\(\\)])`,"g"),S=new RegExp(`([${i}])([\`"״])`,"g"),u=new RegExp(`([\`"״])([${i}])`,"g"),f=/([`"\u05f4]+)[ ]*(.+?)[ ]*([`"\u05f4]+)/g,C=/([\u201d])([A-Za-z0-9])/g,b=new RegExp(`([${i}])(")([A-Za-z0-9])`,"g"),R=new RegExp(`([${i}])('[^s])`,"g"),P=new RegExp(`(')([${i}])`,"g"),O=new RegExp(`([A-Za-z0-9${i}])( )('s)`,"g"),B=new RegExp(`([${i}])(#)([${i}]+)(#)([${i}])`,"g"),K=new RegExp(`([${i}])(#([^ ]))`,"g"),L=new RegExp(`(([^ ])#)([${i}])`,"g"),v=new RegExp(`([${i}])([\\+\\-\\*\\/=&\\|<>])([A-Za-z0-9])`,"g"),I=new RegExp(`([A-Za-z0-9])([\\+\\-\\*\\/=&\\|<>])([${i}])`,"g"),J=/([/]) ([a-z\-_\./]+)/g,z=/([/\.])([A-Za-z\-_\./]+) ([/])/g,D=new RegExp(`([${i}])([\\(\\[\\{<>“])`,"g"),H=new RegExp(`([\\)\\]\\}<>”])([${i}])`,"g"),F=/([\(\[\{<\u201c]+)[ ]*(.+?)[ ]*([\)\]\}>\u201d]+)/,X=new RegExp(`([A-Za-z0-9${i}])[ ]*([“])([A-Za-z0-9${i}\\-_ ]+)([”])`,"g"),Q=new RegExp(`([“])([A-Za-z0-9${i}\\-_ ]+)([”])[ ]*([A-Za-z0-9${i}])`,"g"),Z=/([A-Za-z0-9])([\(\[\{])/g,M=/([\)\]\}])([A-Za-z0-9])/g,U=new RegExp(`([${i}])([A-Za-zͰ-Ͽ0-9@\\$%\\^&\\*\\-\\+\\\\=\\|/¡-ÿ⅐-↏✀—➿])`,"g"),k=new RegExp(`([A-Za-zͰ-Ͽ0-9~\\$%\\^&\\*\\-\\+\\\\=\\|/!;:,\\.\\?¡-ÿ⅐-↏✀—➿])([${i}])`,"g"),G=/(%)([A-Za-z])/g,Y=/([ ]*)([\u00b7\u2022\u2027])([ ]*)/g;class V{constructor(){this.version="4.0.7"}convertToFullwidth(t){return t.replace(/~/g,"～").replace(/!/g,"！").replace(/;/g,"；").replace(/:/g,"：").replace(/,/g,"，").replace(/\./g,"。").replace(/\?/g,"？")}spacingSync(t){if(typeof t!="string")return console.warn(`spacing(text) only accepts string but got ${typeof t}`),t;if(t.length<=1||!$.test(t))return t;const s=this;let e=t;return e=e.replace(y,(n,a,o,h)=>{const g=s.convertToFullwidth(o);return`${a}${g}${h}`}),e=e.replace(_,(n,a,o)=>{const h=s.convertToFullwidth(o);return`${a}${h}`}),e=e.replace(m,"$1 $2"),e=e.replace(A,"$1：$2"),e=e.replace(S,"$1 $2"),e=e.replace(u,"$1 $2"),e=e.replace(f,"$1$2$3"),e=e.replace(C,"$1 $2"),e=e.replace(b,"$1$2 $3"),e=e.replace(R,"$1 $2"),e=e.replace(P,"$1 $2"),e=e.replace(O,"$1's"),e=e.replace(B,"$1 $2$3$4 $5"),e=e.replace(K,"$1 $2"),e=e.replace(L,"$1 $3"),e=e.replace(v,"$1 $2 $3"),e=e.replace(I,"$1 $2 $3"),e=e.replace(J,"$1$2"),e=e.replace(z,"$1$2$3"),e=e.replace(D,"$1 $2"),e=e.replace(H,"$1 $2"),e=e.replace(F,"$1$2$3"),e=e.replace(X,"$1 $2$3$4"),e=e.replace(Q,"$1$2$3 $4"),e=e.replace(Z,"$1 $2"),e=e.replace(M,"$1 $2"),e=e.replace(U,"$1 $2"),e=e.replace(k,"$1 $2"),e=e.replace(G,"$1 $2"),e=e.replace(Y,"・"),e}spacing(t,s){if(s){let e;try{e=this.spacingSync(t)}catch(n){s(n);return}s(null,e)}else return new Promise((e,n)=>{try{const a=this.spacingSync(t);e(a)}catch(a){n(a)}})}spacingText(t,s){return this.spacing(t,s)}spacingTextSync(t){return this.spacingSync(t)}}function j(N){let t=!1;return function(...s){if(!t)return t=!0,N.apply(this,s)}}function W(N,t,s=1/0){let e=null,n=null;return function(...a){const o=Date.now();e&&clearTimeout(e),n||(n=o),o-n>=s?(N.apply(this,a),n=o):e=window.setTimeout(()=>{N.apply(this,a)},t)}}class x extends V{constructor(){super(),this.blockTags=/^(div|p|h1|h2|h3|h4|h5|h6)$/i,this.ignoredTags=/^(script|code|pre|textarea)$/i,this.presentationalTags=/^(b|code|del|em|i|s|strong|kbd)$/i,this.spaceLikeTags=/^(br|hr|i|img|pangu)$/i,this.spaceSensitiveTags=/^(a|del|pre|s|strike|u)$/i,this.isAutoSpacingPageExecuted=!1}isContentEditable(t){return t.isContentEditable||t.getAttribute&&t.getAttribute("g_editable")==="true"}isSpecificTag(t,s){return t&&t.nodeName&&t.nodeName.search(s)>=0}isInsideSpecificTag(t,s,e=!1){let n=t;if(e&&this.isSpecificTag(n,s))return!0;for(;n.parentNode;)if(n=n.parentNode,this.isSpecificTag(n,s))return!0;return!1}canIgnoreNode(t){let s=t;if(s&&(this.isSpecificTag(s,this.ignoredTags)||this.isContentEditable(s)))return!0;for(;s.parentNode;)if(s=s.parentNode,s&&(this.isSpecificTag(s,this.ignoredTags)||this.isContentEditable(s)))return!0;return!1}isFirstTextChild(t,s){const{childNodes:e}=t;for(let n=0;n<e.length;n++){const a=e[n];if(a.nodeType!==Node.COMMENT_NODE&&a.textContent)return a===s}return!1}isLastTextChild(t,s){const{childNodes:e}=t;for(let n=e.length-1;n>-1;n--){const a=e[n];if(a.nodeType!==Node.COMMENT_NODE&&a.textContent)return a===s}return!1}spacingNodeByXPath(t,s){if(!(s instanceof Node)||s instanceof DocumentFragment)return;const e=document.evaluate(t,s,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);let n,a;for(let o=e.snapshotLength-1;o>-1;--o){if(n=e.snapshotItem(o),this.isSpecificTag(n.parentNode,this.presentationalTags)&&!this.isInsideSpecificTag(n.parentNode,this.ignoredTags)){const g=n.parentNode;if(g.previousSibling){const{previousSibling:p}=g;if(p.nodeType===Node.TEXT_NODE){const c=p.data.substr(-1)+n.data.toString().charAt(0),r=this.spacingSync(c);c!==r&&(p.data=`${p.data} `)}}if(g.nextSibling){const{nextSibling:p}=g;if(p.nodeType===Node.TEXT_NODE){const c=n.data.substr(-1)+p.data.toString().charAt(0),r=this.spacingSync(c);c!==r&&(p.data=` ${p.data}`)}}}if(this.canIgnoreNode(n)){a=n;continue}const h=this.spacingSync(n.data);if(n.data!==h&&(n.data=h),a){if(n.nextSibling&&n.nextSibling.nodeName.search(this.spaceLikeTags)>=0){a=n;continue}const g=n.data.toString().substr(-1)+a.data.toString().substr(0,1);if(this.spacingSync(g)!==g){let c=a;for(;c.parentNode&&c.nodeName.search(this.spaceSensitiveTags)===-1&&this.isFirstTextChild(c.parentNode,c);)c=c.parentNode;let r=n;for(;r.parentNode&&r.nodeName.search(this.spaceSensitiveTags)===-1&&this.isLastTextChild(r.parentNode,r);)r=r.parentNode;if(r.nextSibling&&r.nextSibling.nodeName.search(this.spaceLikeTags)>=0){a=n;continue}if(r.nodeName.search(this.blockTags)===-1)if(c.nodeName.search(this.spaceSensitiveTags)===-1)c.nodeName.search(this.ignoredTags)===-1&&c.nodeName.search(this.blockTags)===-1&&(a.previousSibling?a.previousSibling.nodeName.search(this.spaceLikeTags)===-1&&(a.data=` ${a.data}`):this.canIgnoreNode(a)||(a.data=` ${a.data}`));else if(r.nodeName.search(this.spaceSensitiveTags)===-1)n.data=`${n.data} `;else{const l=document.createElement("pangu");l.innerHTML=" ",c.previousSibling?c.previousSibling.nodeName.search(this.spaceLikeTags)===-1&&c.parentNode.insertBefore(l,c):c.parentNode.insertBefore(l,c),l.previousElementSibling||l.parentNode&&l.parentNode.removeChild(l)}}}a=n}}spacingNodeSync(t){let s=".//*/text()[normalize-space(.)]";t instanceof Element&&t.children&&t.children.length===0&&(s=".//text()[normalize-space(.)]"),this.spacingNodeByXPath(s,t)}spacingNode(t){return T(this,null,function*(){return this.spacingNodeSync(t)})}spacingElementByIdSync(t){const s=`id("${t}")//text()`;this.spacingNodeByXPath(s,document)}spacingElementById(t){return T(this,null,function*(){return this.spacingElementByIdSync(t)})}spacingElementByClassNameSync(t){const s=`//*[contains(concat(" ", normalize-space(@class), " "), "${t}")]//text()`;this.spacingNodeByXPath(s,document)}spacingElementByClassName(t){return T(this,null,function*(){return this.spacingElementByClassNameSync(t)})}spacingElementByTagNameSync(t){const s=`//${t}//text()`;this.spacingNodeByXPath(s,document)}spacingElementByTagName(t){return T(this,null,function*(){return this.spacingElementByTagNameSync(t)})}spacingPageTitleSync(){this.spacingNodeByXPath("/html/head/title/text()",document)}spacingPageTitle(){return T(this,null,function*(){return this.spacingPageTitleSync()})}spacingPageBodySync(){let t="/html/body//*/text()[normalize-space(.)]";["script","style","textarea"].forEach(s=>{t=`${t}[translate(name(..),"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")!="${s}"]`}),this.spacingNodeByXPath(t,document)}spacingPageBody(){return T(this,null,function*(){return this.spacingPageBodySync()})}spacingPageSync(){this.spacingPageTitleSync(),this.spacingPageBodySync()}spacingPage(){return T(this,null,function*(){yield this.spacingPageTitle(),yield this.spacingPageBody()})}autoSpacingPage(t=1e3,s=500,e=2e3){if(!(document.body instanceof Node)||this.isAutoSpacingPageExecuted)return;this.isAutoSpacingPageExecuted=!0;const n=j(()=>{this.spacingPageSync()}),a=document.getElementsByTagName("video");if(a.length===0)setTimeout(()=>{n()},t);else for(let c=0;c<a.length;c++){const r=a[c];if(r.readyState===4){setTimeout(()=>{n()},3e3);break}r.addEventListener("loadeddata",()=>{setTimeout(()=>{n()},4e3)})}const o=[],h=this,g=W(()=>{for(;o.length;){const c=o.shift();c&&h.spacingNodeSync(c)}},s,e);new MutationObserver(c=>{c.forEach(r=>{switch(r.type){case"childList":r.addedNodes.forEach(E=>{E.nodeType===Node.ELEMENT_NODE?o.push(E):E.nodeType===Node.TEXT_NODE&&E.parentNode&&o.push(E.parentNode)});break;case"characterData":const{target:l}=r;l.nodeType===Node.TEXT_NODE&&l.parentNode&&o.push(l.parentNode);break}}),g()}).observe(document.body,{characterData:!0,childList:!0,subtree:!0})}}const w=new x;d.BrowserPangu=x,d.default=w,d.pangu=w,Object.defineProperties(d,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=pangu.umd.js.map
