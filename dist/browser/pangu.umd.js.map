{"version":3,"file":"pangu.umd.js","sources":["../../src/shared/index.ts","../../src/browser/pangu.ts"],"sourcesContent":["// CJK is an acronym for Chinese, Japanese, and Korean.\n//\n// CJK includes the following Unicode blocks:\n// \\u2e80-\\u2eff CJK Radicals Supplement\n// \\u2f00-\\u2fdf Kangxi Radicals\n// \\u3040-\\u309f Hiragana\n// \\u30a0-\\u30ff Katakana\n// \\u3100-\\u312f Bopomofo\n// \\u3200-\\u32ff Enclosed CJK Letters and Months\n// \\u3400-\\u4dbf CJK Unified Ideographs Extension A\n// \\u4e00-\\u9fff CJK Unified Ideographs\n// \\uf900-\\ufaff CJK Compatibility Ideographs\n//\n// For more information about Unicode blocks, see\n// http://unicode-table.com/en/\n// https://github.com/vinta/pangu\n//\n// all J below does not include \\u30fb\nconst CJK = '\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30fa\\u30fc-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff';\n\n// ANS is short for Alphabets, Numbers, and Symbols.\n//\n// A includes A-Za-z\\u0370-\\u03ff\n// N includes 0-9\n// S includes `~!@#$%^&*()-_=+[]{}\\|;:'\",<.>/?\n//\n// some S below does not include all symbols\n\nconst ANY_CJK = new RegExp(`[${CJK}]`);\n\n// the symbol part only includes ~ ! ; : , . ? but . only matches one character\nconst CONVERT_TO_FULLWIDTH_CJK_SYMBOLS_CJK = new RegExp(`([${CJK}])[ ]*([\\\\:]+|\\\\.)[ ]*([${CJK}])`, 'g');\nconst CONVERT_TO_FULLWIDTH_CJK_SYMBOLS = new RegExp(`([${CJK}])[ ]*([~\\\\!;,\\\\?]+)[ ]*`, 'g');\nconst DOTS_CJK = new RegExp(`([\\\\.]{2,}|\\u2026)([${CJK}])`, 'g');\nconst FIX_CJK_COLON_ANS = new RegExp(`([${CJK}])\\\\:([A-Z0-9\\\\(\\\\)])`, 'g');\n\n// the symbol part does not include '\nconst CJK_QUOTE = new RegExp(`([${CJK}])([\\`\"\\u05f4])`, 'g');\nconst QUOTE_CJK = new RegExp(`([\\`\"\\u05f4])([${CJK}])`, 'g');\nconst FIX_QUOTE_ANY_QUOTE = /([`\"\\u05f4]+)[ ]*(.+?)[ ]*([`\"\\u05f4]+)/g;\n\n// Handle curly quotes with alphanumeric characters\n// These patterns should only apply to curly quotes, not straight quotes\n// Straight quotes are already handled by CJK_QUOTE, QUOTE_CJK and FIX_QUOTE_ANY_QUOTE\nconst QUOTE_AN = /([\\u201d])([A-Za-z0-9])/g;  // Only closing curly quotes + AN\n\n// Special handling for straight quotes followed by alphanumeric after CJK\n// This catches patterns like: 社\"DF where the quote appears to be closing a quoted CJK phrase\nconst CJK_QUOTE_AN = new RegExp(`([${CJK}])(\")([A-Za-z0-9])`, 'g');\n\nconst CJK_SINGLE_QUOTE_BUT_POSSESSIVE = new RegExp(`([${CJK}])('[^s])`, 'g');\nconst SINGLE_QUOTE_CJK = new RegExp(`(')([${CJK}])`, 'g');\nconst FIX_POSSESSIVE_SINGLE_QUOTE = new RegExp(`([A-Za-z0-9${CJK}])( )('s)`, 'g');\n\nconst HASH_ANS_CJK_HASH = new RegExp(`([${CJK}])(#)([${CJK}]+)(#)([${CJK}])`, 'g');\nconst CJK_HASH = new RegExp(`([${CJK}])(#([^ ]))`, 'g');\nconst HASH_CJK = new RegExp(`(([^ ])#)([${CJK}])`, 'g');\n\n// the symbol part only includes + - * / = & | < >\nconst CJK_OPERATOR_ANS = new RegExp(`([${CJK}])([\\\\+\\\\-\\\\*\\\\/=&\\\\|<>])([A-Za-z0-9])`, 'g');\nconst ANS_OPERATOR_CJK = new RegExp(`([A-Za-z0-9])([\\\\+\\\\-\\\\*\\\\/=&\\\\|<>])([${CJK}])`, 'g');\n\nconst FIX_SLASH_AS = /([/]) ([a-z\\-_\\./]+)/g;\nconst FIX_SLASH_AS_SLASH = /([/\\.])([A-Za-z\\-_\\./]+) ([/])/g;\n\n// the bracket part only includes ( ) [ ] { } < > “ ”\nconst CJK_LEFT_BRACKET = new RegExp(`([${CJK}])([\\\\(\\\\[\\\\{<>\\u201c])`, 'g');\nconst RIGHT_BRACKET_CJK = new RegExp(`([\\\\)\\\\]\\\\}<>\\u201d])([${CJK}])`, 'g');\nconst FIX_LEFT_BRACKET_ANY_RIGHT_BRACKET = /([\\(\\[\\{<\\u201c]+)[ ]*(.+?)[ ]*([\\)\\]\\}>\\u201d]+)/;\nconst ANS_CJK_LEFT_BRACKET_ANY_RIGHT_BRACKET = new RegExp(`([A-Za-z0-9${CJK}])[ ]*([\\u201c])([A-Za-z0-9${CJK}\\\\-_ ]+)([\\u201d])`, 'g');\nconst LEFT_BRACKET_ANY_RIGHT_BRACKET_ANS_CJK = new RegExp(`([\\u201c])([A-Za-z0-9${CJK}\\\\-_ ]+)([\\u201d])[ ]*([A-Za-z0-9${CJK}])`, 'g');\n\nconst AN_LEFT_BRACKET = /([A-Za-z0-9])([\\(\\[\\{])/g;\nconst RIGHT_BRACKET_AN = /([\\)\\]\\}])([A-Za-z0-9])/g;\n\nconst CJK_ANS = new RegExp(`([${CJK}])([A-Za-z\\u0370-\\u03ff0-9@\\\\$%\\\\^&\\\\*\\\\-\\\\+\\\\\\\\=\\\\|/\\u00a1-\\u00ff\\u2150-\\u218f\\u2700—\\u27bf])`, 'g');\nconst ANS_CJK = new RegExp(`([A-Za-z\\u0370-\\u03ff0-9~\\\\$%\\\\^&\\\\*\\\\-\\\\+\\\\\\\\=\\\\|/!;:,\\\\.\\\\?\\u00a1-\\u00ff\\u2150-\\u218f\\u2700—\\u27bf])([${CJK}])`, 'g');\n\nconst S_A = /(%)([A-Za-z])/g;\n\nconst MIDDLE_DOT = /([ ]*)([\\u00b7\\u2022\\u2027])([ ]*)/g;\n\nexport class Pangu {\n  version: string;\n\n  constructor() {\n    this.version = '4.0.7';\n  }\n\n  convertToFullwidth(symbols: string): string {\n    return symbols\n      .replace(/~/g, '～')\n      .replace(/!/g, '！')\n      .replace(/;/g, '；')\n      .replace(/:/g, '：')\n      .replace(/,/g, '，')\n      .replace(/\\./g, '。')\n      .replace(/\\?/g, '？');\n  }\n\n  spacingSync(text: string): string {\n    if (typeof text !== 'string') {\n      console.warn(`spacing(text) only accepts string but got ${typeof text}`); // eslint-disable-line no-console\n      return text;\n    }\n\n    if (text.length <= 1 || !ANY_CJK.test(text)) {\n      return text;\n    }\n\n    const self = this;\n\n    // DEBUG\n    // String.prototype.rawReplace = String.prototype.replace;\n    // String.prototype.replace = function(regexp, newSubstr) {\n    //   const oldText = this;\n    //   const newText = this.rawReplace(regexp, newSubstr);\n    //   if (oldText !== newText) {\n    //     console.log(`regexp: ${regexp}`);\n    //     console.log(`oldText: ${oldText}`);\n    //     console.log(`newText: ${newText}`);\n    //   }\n    //   return newText;\n    // };\n\n    let newText = text;\n\n    // https://stackoverflow.com/questions/4285472/multiple-regex-replace\n    newText = newText.replace(CONVERT_TO_FULLWIDTH_CJK_SYMBOLS_CJK, (_match, leftCjk, symbols, rightCjk) => {\n      const fullwidthSymbols = self.convertToFullwidth(symbols);\n      return `${leftCjk}${fullwidthSymbols}${rightCjk}`;\n    });\n\n    newText = newText.replace(CONVERT_TO_FULLWIDTH_CJK_SYMBOLS, (_match, cjk, symbols) => {\n      const fullwidthSymbols = self.convertToFullwidth(symbols);\n      return `${cjk}${fullwidthSymbols}`;\n    });\n\n    newText = newText.replace(DOTS_CJK, '$1 $2');\n    newText = newText.replace(FIX_CJK_COLON_ANS, '$1：$2');\n\n    newText = newText.replace(CJK_QUOTE, '$1 $2');\n    newText = newText.replace(QUOTE_CJK, '$1 $2');\n    newText = newText.replace(FIX_QUOTE_ANY_QUOTE, '$1$2$3');\n    \n    // Handle quotes with alphanumeric - closing quotes followed by AN need space\n    newText = newText.replace(QUOTE_AN, '$1 $2');\n    // Opening quotes preceded by AN don't need space (they're handled by other patterns)\n    \n    // Handle CJK followed by closing quote followed by alphanumeric\n    newText = newText.replace(CJK_QUOTE_AN, '$1$2 $3');\n\n    newText = newText.replace(CJK_SINGLE_QUOTE_BUT_POSSESSIVE, '$1 $2');\n    newText = newText.replace(SINGLE_QUOTE_CJK, '$1 $2');\n    newText = newText.replace(FIX_POSSESSIVE_SINGLE_QUOTE, \"$1's\"); // eslint-disable-line quotes\n\n    newText = newText.replace(HASH_ANS_CJK_HASH, '$1 $2$3$4 $5');\n    newText = newText.replace(CJK_HASH, '$1 $2');\n    newText = newText.replace(HASH_CJK, '$1 $3');\n\n    newText = newText.replace(CJK_OPERATOR_ANS, '$1 $2 $3');\n    newText = newText.replace(ANS_OPERATOR_CJK, '$1 $2 $3');\n\n    newText = newText.replace(FIX_SLASH_AS, '$1$2');\n    newText = newText.replace(FIX_SLASH_AS_SLASH, '$1$2$3');\n\n    newText = newText.replace(CJK_LEFT_BRACKET, '$1 $2');\n    newText = newText.replace(RIGHT_BRACKET_CJK, '$1 $2');\n    newText = newText.replace(FIX_LEFT_BRACKET_ANY_RIGHT_BRACKET, '$1$2$3');\n    newText = newText.replace(ANS_CJK_LEFT_BRACKET_ANY_RIGHT_BRACKET, '$1 $2$3$4');\n    newText = newText.replace(LEFT_BRACKET_ANY_RIGHT_BRACKET_ANS_CJK, '$1$2$3 $4');\n\n    newText = newText.replace(AN_LEFT_BRACKET, '$1 $2');\n    newText = newText.replace(RIGHT_BRACKET_AN, '$1 $2');\n\n    newText = newText.replace(CJK_ANS, '$1 $2');\n    newText = newText.replace(ANS_CJK, '$1 $2');\n\n    newText = newText.replace(S_A, '$1 $2');\n\n    newText = newText.replace(MIDDLE_DOT, '・');\n\n    // DEBUG\n    // String.prototype.replace = String.prototype.rawReplace;\n\n    return newText;\n  }\n\n  spacing(text: string): Promise<string>;\n  spacing(text: string, callback: (err: any, result?: string) => void): void;\n  spacing(text: string, callback?: (err: any, result?: string) => void): Promise<string> | void {\n    if (callback) {\n      // Callback mode\n      let newText;\n      try {\n        newText = this.spacingSync(text);\n      } catch (err) {\n        callback(err);\n        return;\n      }\n      callback(null, newText);\n    } else {\n      // Promise mode\n      return new Promise((resolve, reject) => {\n        try {\n          const newText = this.spacingSync(text);\n          resolve(newText);\n        } catch (err) {\n          reject(err);\n        }\n      });\n    }\n  }\n\n  // Deprecated: Use spacing() instead\n  spacingText(text: string): Promise<string>;\n  spacingText(text: string, callback: (err: any, result?: string) => void): void;\n  spacingText(text: string, callback?: (err: any, result?: string) => void): Promise<string> | void {\n    return this.spacing(text, callback as any);\n  }\n\n  spacingTextSync(text: string): string {\n    return this.spacingSync(text);\n  }\n}\n\n// Create default instance\nexport const pangu = new Pangu();\n\n// Default export\nexport default pangu;\n","import { Pangu } from '../shared';\n\nfunction once<T extends (...args: any[]) => any>(func: T): T {\n  let executed = false;\n  return function(this: any, ...args: Parameters<T>) {\n    if (executed) {\n      return;\n    }\n    executed = true;\n    return func.apply(this, args);\n  } as T;\n}\n\nfunction debounce<T extends (...args: any[]) => any>(\n  func: T,\n  delay: number,\n  mustRunDelay: number = Infinity\n): T {\n  let timer: number | null = null;\n  let startTime: number | null = null;\n  \n  return function(this: any, ...args: Parameters<T>) {\n    const currentTime = Date.now();\n    \n    if (timer) {\n      clearTimeout(timer);\n    }\n    \n    if (!startTime) {\n      startTime = currentTime;\n    }\n    \n    if (currentTime - startTime >= mustRunDelay) {\n      func.apply(this, args);\n      startTime = currentTime;\n    } else {\n      timer = window.setTimeout(() => {\n        func.apply(this, args);\n      }, delay);\n    }\n  } as T;\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\n\nexport class BrowserPangu extends Pangu {\n  blockTags: RegExp;\n  ignoredTags: RegExp;\n  presentationalTags: RegExp;\n  spaceLikeTags: RegExp;\n  spaceSensitiveTags: RegExp;\n  isAutoSpacingPageExecuted: boolean;\n\n  constructor() {\n    super();\n\n    this.blockTags = /^(div|p|h1|h2|h3|h4|h5|h6)$/i;\n    this.ignoredTags = /^(script|code|pre|textarea)$/i;\n    this.presentationalTags = /^(b|code|del|em|i|s|strong|kbd)$/i;\n    this.spaceLikeTags = /^(br|hr|i|img|pangu)$/i;\n    this.spaceSensitiveTags = /^(a|del|pre|s|strike|u)$/i;\n    this.isAutoSpacingPageExecuted = false;\n\n    // TODO\n    // this.ignoredTags adds iframe|pangu\n    // this.ignoreClasses\n    // this.ignoreAttributes\n  }\n\n  isContentEditable(node: any): boolean {\n    return ((node.isContentEditable) || (node.getAttribute && node.getAttribute('g_editable') === 'true'));\n  }\n\n  isSpecificTag(node: any, tagRegex: RegExp): boolean {\n    return (node && node.nodeName && node.nodeName.search(tagRegex) >= 0);\n  }\n\n  isInsideSpecificTag(node: any, tagRegex: RegExp, checkCurrent = false): boolean {\n    let currentNode = node;\n    if (checkCurrent) {\n      if (this.isSpecificTag(currentNode, tagRegex)) {\n        return true;\n      }\n    }\n    while (currentNode.parentNode) {\n      currentNode = currentNode.parentNode;\n      if (this.isSpecificTag(currentNode, tagRegex)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  canIgnoreNode(node: Node): boolean {\n    let currentNode = node;\n    if (currentNode && (this.isSpecificTag(currentNode, this.ignoredTags) || this.isContentEditable(currentNode))) {\n      return true;\n    }\n    while (currentNode.parentNode) {\n      currentNode = currentNode.parentNode;\n      if (currentNode && (this.isSpecificTag(currentNode, this.ignoredTags) || this.isContentEditable(currentNode))) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  isFirstTextChild(parentNode: Node, targetNode: Node): boolean {\n    const { childNodes } = parentNode;\n\n    // 只判斷第一個含有 text 的 node\n    for (let i = 0; i < childNodes.length; i++) {\n      const childNode = childNodes[i];\n      if (childNode.nodeType !== Node.COMMENT_NODE && childNode.textContent) {\n        return childNode === targetNode;\n      }\n    }\n    return false;\n  }\n\n  isLastTextChild(parentNode: Node, targetNode: Node): boolean {\n    const { childNodes } = parentNode;\n\n    // 只判斷倒數第一個含有 text 的 node\n    for (let i = childNodes.length - 1; i > -1; i--) {\n      const childNode = childNodes[i];\n      if (childNode.nodeType !== Node.COMMENT_NODE && childNode.textContent) {\n        return childNode === targetNode;\n      }\n    }\n    return false;\n  }\n\n  spacingNodeByXPath(xPathQuery: string, contextNode: Node): void {\n    if (!(contextNode instanceof Node) || (contextNode instanceof DocumentFragment)) {\n      return;\n    }\n\n    // 因為 xPathQuery 會是用 text() 結尾，所以這些 nodes 會是 text 而不是 DOM element\n    // snapshotLength 要配合 XPathResult.ORDERED_NODE_SNAPSHOT_TYPE 使用\n    // https://developer.mozilla.org/en-US/docs/DOM/document.evaluate\n    // https://developer.mozilla.org/en-US/docs/Web/API/XPathResult\n    const textNodes = document.evaluate(xPathQuery, contextNode, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);\n\n    let currentTextNode;\n    let nextTextNode;\n\n    // 從最下面、最裡面的節點開始，所以是倒序的\n    for (let i = textNodes.snapshotLength - 1; i > -1; --i) {\n      currentTextNode = textNodes.snapshotItem(i);\n\n      if (this.isSpecificTag(currentTextNode.parentNode, this.presentationalTags) && !this.isInsideSpecificTag(currentTextNode.parentNode, this.ignoredTags)) {\n        const elementNode = currentTextNode.parentNode;\n\n        if (elementNode.previousSibling) {\n          const { previousSibling } = elementNode;\n          if (previousSibling.nodeType === Node.TEXT_NODE) {\n            const testText = previousSibling.data.substr(-1) + currentTextNode.data.toString().charAt(0);\n            const testNewText = this.spacingSync(testText);\n            if (testText !== testNewText) {\n              previousSibling.data = `${previousSibling.data} `;\n            }\n          }\n        }\n\n        if (elementNode.nextSibling) {\n          const { nextSibling } = elementNode;\n          if (nextSibling.nodeType === Node.TEXT_NODE) {\n            const testText = currentTextNode.data.substr(-1) + nextSibling.data.toString().charAt(0);\n            const testNewText = this.spacingSync(testText);\n            if (testText !== testNewText) {\n              nextSibling.data = ` ${nextSibling.data}`;\n            }\n          }\n        }\n      }\n\n      if (this.canIgnoreNode(currentTextNode)) {\n        nextTextNode = currentTextNode;\n        continue;\n      }\n\n      const newText = this.spacingSync(currentTextNode.data);\n      if (currentTextNode.data !== newText) {\n        currentTextNode.data = newText;\n      }\n\n      // 處理嵌套的 <tag> 中的文字\n      if (nextTextNode) {\n        // TODO\n        // 現在只是簡單地判斷相鄰的下一個 node 是不是 <br>\n        // 萬一遇上嵌套的標籤就不行了\n        if (currentTextNode.nextSibling && currentTextNode.nextSibling.nodeName.search(this.spaceLikeTags) >= 0) {\n          nextTextNode = currentTextNode;\n          continue;\n        }\n\n        // currentTextNode 的最後一個字 + nextTextNode 的第一個字\n        const testText = currentTextNode.data.toString().substr(-1) + nextTextNode.data.toString().substr(0, 1);\n        const testNewText = this.spacingSync(testText);\n        if (testNewText !== testText) {\n          // 往上找 nextTextNode 的 parent node\n          // 直到遇到 spaceSensitiveTags\n          // 而且 nextTextNode 必須是第一個 text child\n          // 才能把空格加在 nextTextNode 的前面\n          let nextNode = nextTextNode;\n          while (nextNode.parentNode && nextNode.nodeName.search(this.spaceSensitiveTags) === -1 && this.isFirstTextChild(nextNode.parentNode, nextNode)) {\n            nextNode = nextNode.parentNode;\n          }\n\n          let currentNode = currentTextNode;\n          while (currentNode.parentNode && currentNode.nodeName.search(this.spaceSensitiveTags) === -1 && this.isLastTextChild(currentNode.parentNode, currentNode)) {\n            currentNode = currentNode.parentNode;\n          }\n\n          if (currentNode.nextSibling) {\n            if (currentNode.nextSibling.nodeName.search(this.spaceLikeTags) >= 0) {\n              nextTextNode = currentTextNode;\n              continue;\n            }\n          }\n\n          if (currentNode.nodeName.search(this.blockTags) === -1) {\n            if (nextNode.nodeName.search(this.spaceSensitiveTags) === -1) {\n              if ((nextNode.nodeName.search(this.ignoredTags) === -1) && (nextNode.nodeName.search(this.blockTags) === -1)) {\n                if (nextTextNode.previousSibling) {\n                  if (nextTextNode.previousSibling.nodeName.search(this.spaceLikeTags) === -1) {\n                    nextTextNode.data = ` ${nextTextNode.data}`;\n                  }\n                } else {\n                  // dirty hack\n                  if (!this.canIgnoreNode(nextTextNode)) {\n                    nextTextNode.data = ` ${nextTextNode.data}`;\n                  }\n                }\n              }\n            } else if (currentNode.nodeName.search(this.spaceSensitiveTags) === -1) {\n              currentTextNode.data = `${currentTextNode.data} `;\n            } else {\n              const panguSpace = document.createElement('pangu');\n              panguSpace.innerHTML = ' ';\n\n              // 避免一直被加空格\n              if (nextNode.previousSibling) {\n                if (nextNode.previousSibling.nodeName.search(this.spaceLikeTags) === -1) {\n                  nextNode.parentNode.insertBefore(panguSpace, nextNode);\n                }\n              } else {\n                nextNode.parentNode.insertBefore(panguSpace, nextNode);\n              }\n\n              // TODO\n              // 主要是想要避免在元素（通常都是 <li>）的開頭加空格\n              // 這個做法有點蠢，但是不管還是先硬上\n              if (!panguSpace.previousElementSibling) {\n                if (panguSpace.parentNode) {\n                  panguSpace.parentNode.removeChild(panguSpace);\n                }\n              }\n            }\n          }\n        }\n      }\n\n      nextTextNode = currentTextNode;\n    }\n  }\n\n  spacingNodeSync(contextNode: Node): void {\n    let xPathQuery = './/*/text()[normalize-space(.)]';\n    if (contextNode instanceof Element && contextNode.children && contextNode.children.length === 0) {\n      xPathQuery = './/text()[normalize-space(.)]';\n    }\n    this.spacingNodeByXPath(xPathQuery, contextNode);\n  }\n\n  async spacingNode(contextNode: Node): Promise<void> {\n    return this.spacingNodeSync(contextNode);\n  }\n\n  spacingElementByIdSync(idName: string): void {\n    const xPathQuery = `id(\"${idName}\")//text()`;\n    this.spacingNodeByXPath(xPathQuery, document);\n  }\n\n  async spacingElementById(idName: string): Promise<void> {\n    return this.spacingElementByIdSync(idName);\n  }\n\n  spacingElementByClassNameSync(className: string): void {\n    const xPathQuery = `//*[contains(concat(\" \", normalize-space(@class), \" \"), \"${className}\")]//text()`;\n    this.spacingNodeByXPath(xPathQuery, document);\n  }\n\n  async spacingElementByClassName(className: string): Promise<void> {\n    return this.spacingElementByClassNameSync(className);\n  }\n\n  spacingElementByTagNameSync(tagName: string): void {\n    const xPathQuery = `//${tagName}//text()`;\n    this.spacingNodeByXPath(xPathQuery, document);\n  }\n\n  async spacingElementByTagName(tagName: string): Promise<void> {\n    return this.spacingElementByTagNameSync(tagName);\n  }\n\n  spacingPageTitleSync(): void {\n    const xPathQuery = '/html/head/title/text()';\n    this.spacingNodeByXPath(xPathQuery, document);\n  }\n\n  async spacingPageTitle(): Promise<void> {\n    return this.spacingPageTitleSync();\n  }\n\n  spacingPageBodySync(): void {\n    // // >> 任意位置的節點\n    // . >> 當前節點\n    // .. >> 父節點\n    // [] >> 條件\n    // text() >> 節點的文字內容，例如 hello 之於 <tag>hello</tag>\n    // https://www.w3schools.com/xml/xpath_syntax.asp\n    //\n    // [@contenteditable]\n    // 帶有 contenteditable 屬性的節點\n    //\n    // normalize-space(.)\n    // 當前節點的頭尾的空白字元都會被移除，大於兩個以上的空白字元會被置換成單一空白\n    // https://developer.mozilla.org/en-US/docs/Web/XPath/Functions/normalize-space\n    //\n    // name(..)\n    // 父節點的名稱\n    // https://developer.mozilla.org/en-US/docs/Web/XPath/Functions/name\n    //\n    // translate(string, \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\", \"abcdefghijklmnopqrstuvwxyz\")\n    // 將 string 轉換成小寫，因為 XML 是 case-sensitive 的\n    // https://developer.mozilla.org/en-US/docs/Web/XPath/Functions/translate\n    //\n    // 1. 處理 <title>\n    // 2. 處理 <body> 底下的節點\n    // 3. 略過 contentEditable 的節點\n    // 4. 略過特定節點，例如 <script> 和 <style>\n    //\n    // 注意，以下的 query 只會取出各節點的 text 內容！\n    let xPathQuery = '/html/body//*/text()[normalize-space(.)]';\n    ['script', 'style', 'textarea'].forEach((tag) => {\n      // 理論上這幾個 tag 裡面不會包含其他 tag\n      // 所以可以直接用 .. 取父節點\n      // ex: [translate(name(..), \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\", \"abcdefghijklmnopqrstuvwxyz\") != \"script\"]\n      xPathQuery = `${xPathQuery}[translate(name(..),\"ABCDEFGHIJKLMNOPQRSTUVWXYZ\",\"abcdefghijklmnopqrstuvwxyz\")!=\"${tag}\"]`;\n    });\n    this.spacingNodeByXPath(xPathQuery, document);\n  }\n\n  async spacingPageBody(): Promise<void> {\n    return this.spacingPageBodySync();\n  }\n\n  spacingPageSync(): void {\n    this.spacingPageTitleSync();\n    this.spacingPageBodySync();\n  }\n\n  async spacingPage(): Promise<void> {\n    await this.spacingPageTitle();\n    await this.spacingPageBody();\n  }\n\n  autoSpacingPage(pageDelay = 1000, nodeDelay = 500, nodeMaxWait = 2000): void {\n    if (!(document.body instanceof Node)) {\n      return;\n    }\n\n    if (this.isAutoSpacingPageExecuted) {\n      return;\n    }\n    this.isAutoSpacingPageExecuted = true;\n\n    const onceSpacingPage = once(() => {\n      this.spacingPageSync();\n    });\n\n    // TODO\n    // this is a dirty hack for https://github.com/vinta/pangu.js/issues/117\n    const videos = document.getElementsByTagName('video');\n    if (videos.length === 0) {\n      setTimeout(() => {\n        onceSpacingPage();\n      }, pageDelay);\n    } else {\n      for (let i = 0; i < videos.length; i++) {\n        const video = videos[i];\n        if (video.readyState === 4) {\n          setTimeout(() => {\n            onceSpacingPage();\n          }, 3000);\n          break;\n        }\n        video.addEventListener('loadeddata', () => {\n          setTimeout(() => {\n            onceSpacingPage();\n          }, 4000);\n        });\n      }\n    }\n\n    const queue: Node[] = [];\n\n    // it's possible that multiple workers process the queue at the same time\n    const self = this;\n    const debouncedSpacingNodes = debounce(() => {\n      // a single node could be very big which contains a lot of child nodes\n      while (queue.length) {\n        const node = queue.shift();\n        if (node) {\n          self.spacingNodeSync(node);\n        }\n      }\n    }, nodeDelay, nodeMaxWait);\n\n    // https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver\n    const mutationObserver = new MutationObserver((mutations) => {\n      // Element: https://developer.mozilla.org/en-US/docs/Web/API/Element\n      // Text: https://developer.mozilla.org/en-US/docs/Web/API/Text\n      mutations.forEach((mutation) => {\n        switch (mutation.type) { /* eslint-disable indent */\n          case 'childList':\n            mutation.addedNodes.forEach((node) => {\n              if (node.nodeType === Node.ELEMENT_NODE) {\n                queue.push(node);\n              } else if (node.nodeType === Node.TEXT_NODE && node.parentNode) {\n                queue.push(node.parentNode);\n              }\n            });\n            break;\n          case 'characterData':\n            const { target: node } = mutation;\n            if (node.nodeType === Node.TEXT_NODE && node.parentNode) {\n              queue.push(node.parentNode);\n            }\n            break;\n          default:\n            break;\n        }\n      });\n\n      debouncedSpacingNodes();\n    });\n    mutationObserver.observe(document.body, {\n      characterData: true,\n      childList: true,\n      subtree: true,\n    });\n  }\n}\n\n// Create default instance\nexport const pangu = new BrowserPangu();\n\n// Default export\nexport default pangu;\n"],"names":["CJK","ANY_CJK","CONVERT_TO_FULLWIDTH_CJK_SYMBOLS_CJK","CONVERT_TO_FULLWIDTH_CJK_SYMBOLS","DOTS_CJK","FIX_CJK_COLON_ANS","CJK_QUOTE","QUOTE_CJK","FIX_QUOTE_ANY_QUOTE","QUOTE_AN","CJK_QUOTE_AN","CJK_SINGLE_QUOTE_BUT_POSSESSIVE","SINGLE_QUOTE_CJK","FIX_POSSESSIVE_SINGLE_QUOTE","HASH_ANS_CJK_HASH","CJK_HASH","HASH_CJK","CJK_OPERATOR_ANS","ANS_OPERATOR_CJK","FIX_SLASH_AS","FIX_SLASH_AS_SLASH","CJK_LEFT_BRACKET","RIGHT_BRACKET_CJK","FIX_LEFT_BRACKET_ANY_RIGHT_BRACKET","ANS_CJK_LEFT_BRACKET_ANY_RIGHT_BRACKET","LEFT_BRACKET_ANY_RIGHT_BRACKET_ANS_CJK","AN_LEFT_BRACKET","RIGHT_BRACKET_AN","CJK_ANS","ANS_CJK","S_A","MIDDLE_DOT","Pangu","symbols","text","self","newText","_match","leftCjk","rightCjk","fullwidthSymbols","cjk","callback","err","resolve","reject","once","func","executed","args","debounce","delay","mustRunDelay","timer","startTime","currentTime","BrowserPangu","node","tagRegex","checkCurrent","currentNode","parentNode","targetNode","childNodes","i","childNode","xPathQuery","contextNode","textNodes","currentTextNode","nextTextNode","elementNode","previousSibling","testText","testNewText","nextSibling","nextNode","panguSpace","__async","idName","className","tagName","tag","pageDelay","nodeDelay","nodeMaxWait","onceSpacingPage","videos","video","queue","debouncedSpacingNodes","mutations","mutation","pangu"],"mappings":"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"}